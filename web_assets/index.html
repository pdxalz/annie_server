<!DOCTYPE html>
<html lang="en">
<head>
    <base href="__SERVER_URL__/web_assets/">
    <title>Sauvie Wind Data</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/paho-mqtt/1.0.1/mqttws31.js" type="text/javascript">
    </script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <link rel="stylesheet" href="https://www.w3schools.com/w3css/4/w3.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    

    <!--link rel="stylesheet" href="/web_assets/style.css"-->
    <link rel="stylesheet" href="style.css">
    <!-- <script src="/web_assets/common.js" type="text/javascript"></script> -->
    <script src="common.js" type="text/javascript"></script>

</head>

<body class="w3-mobile">
    <div w3-include-html="header.html"></div>
   
    <div class="w3-panel w3-pale-blue">
        <div id="latest-stats"></div>
    </div>

    <div class="w3-panel w3-pale-blue" style="direction: rtl; overflow-x: auto; overflow-y: hidden;">
        <div id="graph-title"></div>
        <div style="width:3000px; height: 500px">
            <canvas id="myChart2" height="500" width="0"></canvas>
        </div>
    </div>

    <div class="w3-panel w3-pale-blue">
        <p> The blue line is the direction. North is at the center of the chart.
            Updates occur every 5 minutes from 10AM to 9PM if it is windy. Otherwise it is only updated on the hour.
            The sensor will be taken down in September for improvements and will return in May.</p>
    </div>

    <div class="w3-panel w3-pale-blue">
        <p style="font-size:150%; text-align: center;">
            If you would like make a donation to help pay for the hardware and recurring costs,
            please click the donate button.</p>
        <form action="https://www.paypal.com/donate" method="post" target="_top">
            <input type="hidden" name="business" value="25GJHM2LDXKG2" />
            <input type="hidden" name="no_recurring" value="1" />
            <input type="hidden" name="item_name" value="Help cover costs for the Sauvie Wind Sensor." />
            <input type="hidden" name="currency_code" value="USD" />
            <input type="image" src="https://www.paypalobjects.com/en_US/i/btn/btn_donate_LG.gif" border="0"
                name="submit" title="PayPal - The safer, easier way to pay online!" alt="Donate with PayPal button" />
            <img alt="" border="0" src="https://www.paypal.com/en_US/i/scr/pixel.gif" width="1" height="1" />
        </form>
    </div>

    <!-- <div class="w3-panel w3-pale-blue">
        <div id="devInfo"></div>
        </div>
        -->
    <div class="w3-panel img-div">
        <img id="windpict" alt="Description of image">
    </div>
   
    <script>

        document.getElementById("windpict").src = apiImage;

        const ctx = document.getElementById('myChart2');

        chart2 = new Chart(ctx, {
            type: "line",
            data: {
                datasets: [{
                    label: "Direction (North at middle)",
                    pointRadius: 1,
                    pointBackgroundColor: "rgb(0,0,255)",
                    borderColor: "blue",
                    fill: false,
                    borderWidth: 4,
                    tension: 0.3
                }, {
                    label: "Wind Speed",
                    pointRadius: 1,
                    pointBackgroundColor: "rgb(0,0,255)",
                    borderColor: "green",
                    borderWidth: 4,
                    fill: false,
                    yAxisID: 'speed',
                    tension: 0.3
                }, {
                    label: "Gusts",
                    pointRadius: 1,
                    pointBackgroundColor: "rgb(255,0,0)",
                    borderColor: "red",
                    fill: false,
                    borderWidth: 1,
                    yAxisID: 'speed',
                    tension: 0.3
                }, {
                    label: "Lulls",
                    pointRadius: 1,
                    pointBackgroundColor: "rgb(255,0,0)",
                    borderColor: "black",
                    fill: '-1',
                    borderWidth: 1,
                    yAxisID: 'speed',
                    tension: 0.3
                },
                ]
            },
            options: {
                plugins: {
                    legend: {   
                        display: true
                }
                },
                scales: {
                    
                    speed:{
                        position: 'right',
                        min: 0, 
                        max:40,
                        ticks:{      
                            color: 'gray',
                            font:{
                                weight: 'bold',
                                size:20
                            }
                        }
                    },
                    direction:{
                        position: 'right',
                        min: 0,
                        max: 8,
                        ticks: {
                            callback: function(value, index, ticks) {
                                var x = ["S", "SW", "W", "NW", "N", "NE", "E", "SE", "S"];
                                return x[value % x.length];
                            },
                            color: 'blue',
                            font:{
                                weight: 'bold',
                                size: 20
                            },
                        }
                    }
                }
            }
        });

        //get today (PST)
        let date = new Date();
        let options = {timeZone: 'America/Los_Angeles',dateStyle: 'short'};
        let pacificCoastTime = date.toLocaleString('en-US', options);

        getData(new Date(Date.parse(pacificCoastTime)));
        includeHTML();
    </script>
</body>

</html>